#! /bin/bash

PACKAGES="vim tmux htop tree cscope gnupg curl ripgrep"

if [[ $* == *--skip* ]]; then
    echo "Skipping package install."
else
    if [ -n "$(uname -a | grep -i ubuntu)" ]; then
        sudo apt-get install $PACKAGES -y
    elif [ -n "$(uname -a | grep -i darwin)" ]; then
        brew install $PACKAGES
    elif [ -n "$(uname -a | grep "GNU/Linux")" ]; then
        sudo pacman -S $PACKAGES
    else
        echo "Cannot install packages on this machine."
    fi
fi

# Delete old user config
rm -rf ~/.vimrc ~/.bash_aliases ~/.zshrc.user ~/.zshenv ~/.tmux.conf ~/.vim

# Add user config
ln -sf $(pwd)/.vimrc ~/.vimrc
ln -sf $(pwd)/.bash_aliases ~/.bash_aliases
ln -sf $(pwd)/.zshrc.user ~/.zshrc.user
ln -sf $(pwd)/.zshrc.user ~/.zshenv
ln -sf $(pwd)/.tmux.conf ~/.tmux.conf
curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim > /dev/null 2>&1

# Add VSCode config (macOS only)
if [ -n "$(uname -a | grep -i darwin)" ]; then
    VSCODE_DIR=~/Library/Application\ Support/Code/User
    if [ -d "$VSCODE_DIR" ]; then
        cp "$VSCODE_DIR/settings.json" "$VSCODE_DIR/settings.json.orig"
        ln -sf "$(pwd)/vscode.json" "$VSCODE_DIR/settings.json"
    else
        echo "VSCode not installed on this machine."
    fi
fi

echo "Setup complete."
